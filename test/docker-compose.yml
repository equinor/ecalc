services:
  dockersnapshots:
    build:
      context: ../
      dockerfile: ./Dockerfile
      target: build
    working_dir: /project/libecalc
    volumes:
      - ../:/project/libecalc
      # Use an anonymous volume to prevent the container's .venv from syncing to host
      - /project/libecalc/.venv
    command: [ "uv", "run", "pytest", "-m", "dockersnapshot", "--snapshot-update" ]
    platform: linux/amd64

  test:
    build:
      context: ../
      dockerfile: ./Dockerfile
      target: build
    working_dir: /project/libecalc
    volumes:
      - ../:/project/libecalc
      # Use an anonymous volume to prevent the container's .venv from syncing to host
      - /project/libecalc/.venv
    command: [ "uv", "run", "pytest", "-n", "auto" ]